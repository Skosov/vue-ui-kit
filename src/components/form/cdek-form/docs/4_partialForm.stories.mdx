import { Meta, Story } from '@storybook/addon-docs';

<Meta
  title="Form/CdekForm/PartialForm"
  parameters={{
    version: {
      major: '0',
      minor: '0',
      patch: '1',
      postfix: 'alpha',
      style: {
        background: 'rgba(228, 0, 41, 0.05)',
        color: '#e40029',
      },
    },
  }}
/>

# Частичная форма

В некоторых случаях формы могут быть довольно сложными, и становится трудно обработать всю форму, как
единое целое. Тогда подойдет механизм частичных форм.

Логика состоит в том, чтобы не создавать одну `CdekForm`, а несколько, каждая будет отвечать за свой
блок данных.

```js
<CdekForm>
  <CdekFormControl name="firstName">
  <CdekFormControl name="surname">
</CdekForm>

<CdekForm>
  <CdekFormControl name="firstName">
  <CdekFormControl name="surname">
</CdekForm>

<CdekButton>Отправить</CdekButton>
```

`CdekForm` отлавливает событие `submit` на форме, но в этом случае в форме нет никакой кнопки. Чтобы
получить проверенные данные нужно стриггерить событие `submit`. Для этого `CdekForm` предоставляет
наружу метод `triggerSubmit`.

Чтобы его вызвать нужно получить `ref` от `CdekForm`.

```ts
import { ref } from 'vue';
import { CdekForm } from '@cdek-ui-kit/vue';

const cdekFormRef = ref<InstanceType<typeof CdekForm> | null>(null);

onMounted(() => {
  cdekFormRef.value?.triggerSubmit();
})
...

<CdekForm ref="cdekFormRef">
  ...
</CdekForm>
```

Этот метод стриггерит событие `submit`, если на него подписаться, то вы получите данные как обычно.
Также можно просто обработать результат функции `triggerSubmit`.

```ts
type FormSubmitResult = {
  /**
   * `true` - все валидации прошли успешно
   * `false` - есть ошибки
   */
  isValid: boolean;
  /**
   * Объект с ошибками, такой же, как приходит в событии `submitError`
   *
   * Придет только если `isValid === false`
   */
  errors?: ErrorsT;
  /**
   * Объект со значениями формы, такой же, как приходит в событии `submit`
   *
   * Придет только если `isValid === true`
   */
  values?: FieldsT;
};
```

> Поле `firstName` - обязательное, попробуйте нажать на "Вызвать submit"

> Введите что-нибудь в `firstName` и нажмите на "Вызвать submit"

<Story id="form-cdekform--manual-submit" />

---

### Типы

```ts
export type FormSubmitResult = {
  isValid: boolean;
  errors?: ErrorsT;
  values?: FieldsT;
};
```
